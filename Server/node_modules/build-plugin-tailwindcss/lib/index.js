"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tailwindcss = require("tailwindcss");
// @ts-ignore 类型文件缺失
const postcssPxToVW = require("postcss-px-to-viewport");
const checkPostcssLoader = (config, ruleName) => config.module.rules.has(ruleName) &&
    config.module.rule(ruleName).uses.has('postcss-loader');
const plugin = ({ onGetWebpackConfig }) => {
    onGetWebpackConfig((config) => {
        const rules = [
            'css',
            'css-module',
            'css-global',
            'scss',
            'scss-module',
            'scss-global',
        ];
        rules.forEach((rule) => {
            if (checkPostcssLoader(config, rule)) {
                config.module
                    .rule(rule)
                    .use('postcss-loader')
                    .tap((options) => ({
                    ...options,
                    postcssOptions: {
                        ...options.postcssOptions,
                        plugins: [
                            tailwindcss,
                            postcssPxToVW({
                                unitToConvert: 'rem',
                                viewportWidth: 375 / 16,
                                minPixelValue: 0,
                            }),
                            ...options.postcssOptions.plugins,
                        ],
                    },
                }));
            }
        });
    });
};
exports.default = plugin;
